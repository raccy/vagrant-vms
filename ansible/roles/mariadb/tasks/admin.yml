- name: yum install python mysql for ansible
  become: yes
  yum:
    state: present
    name: python2-PyMySQL
  when: ansible_pkg_mgr == "yum"

- name: dnf install python mysql for ansible
  become: yes
  dnf:
    state: present
    name: python3-PyMySQL
  when: ansible_pkg_mgr == "dnf"

# < Debian 11, < Ubuntu 22
- name: apt install python mysql for ansible
  become: yes
  apt:
    state: present
    name: python-pymysql
  when: |
    ansible_pkg_mgr == "apt" and (
      (ansible_distribution == "Debian" and ansible_distribution_major_version | int < 11) or
      (ansible_distribution == "Ubuntu" and ansible_distribution_major_version | int < 22))

# >= Debian 11, >= Ubuntu 22
- name: apt install python mysql for ansible
  become: yes
  apt:
    state: present
    name: python3-pymysql
  when: |
    ansible_pkg_mgr == "apt" and (
      (ansible_distribution == "Debian" and ansible_distribution_major_version | int >= 11) or
      (ansible_distribution == "Ubuntu" and ansible_distribution_major_version | int >= 22))

- name: create admin user
  become: yes
  mysql_user:
    login_unix_socket: '{{ mariadb.socket }}'
    login_user: root
    state: present
    name: '{{ mariadb.admin.name }}'
    host: localhost
    password: '{{ mariadb.admin.password }}'
    priv: '*.*:ALL'
