# slapd config

dn: cn=config
objectClass: olcGlobal
cn: config

dn: cn=module,cn=config
objectClass: olcModuleList
cn: module
olcModulepath: {{ openldap.module_dir }}/usr/lib64/openldap
# olcModuleload: accesslog
# olcModuleload: auditlog
# olcModuleload: back_dnssrv
# olcModuleload: back_ldap
olcModuleload: back_mdb
# olcModuleload: back_meta
# olcModuleload: back_null
# olcModuleload: back_passwd
# olcModuleload: back_relay
# olcModuleload: back_shell
# olcModuleload: back_sock
# olcModuleload: collect
# olcModuleload: constraint
# olcModuleload: dds
# olcModuleload: deref
# olcModuleload: dyngroup
# olcModuleload: dynlist
olcModuleload: memberof
# olcModuleload: pcache
# olcModuleload: ppolicy
# olcModuleload: refint
# olcModuleload: retcode
# olcModuleload: rwm
# olcModuleload: seqmod
# olcModuleload: smbk5pwd
# olcModuleload: sssvlv
# olcModuleload: syncprov
# olcModuleload: translucent
# olcModuleload: unique
# olcModuleload: valsort

dn: cn=schema,cn=config
objectClass: olcSchemaConfig
cn: schema
include: file://{{ openldap.config_dir }}/schema/core.ldif
include: file://{{ openldap.config_dir }}/schema/cosine.ldif
include: file://{{ openldap.config_dir }}/schema/nis.ldif
include: file://{{ openldap.config_dir }}/schema/inetorgperson.ldif
include: file://{{ openldap.config_dir }}/schema/misc.ldif
# include: file://{{ openldap.config_dir }}/schema/collective.ldif
# include: file://{{ openldap.config_dir }}/schema/corba.ldif
# include: file://{{ openldap.config_dir }}/schema/duaconf.ldif
# include: file://{{ openldap.config_dir }}/schema/dyngroup.ldif
# include: file://{{ openldap.config_dir }}/schema/java.ldif
# include: file://{{ openldap.config_dir }}/schema/openldap.ldif
# include: file://{{ openldap.config_dir }}/schema/pmi.ldif
# include: file://{{ openldap.config_dir }}/schema/ppolicy.ldif
include: file://{{ openldap.config_dir }}/schema/samba.ldif
include: file://{{ openldap.config_dir }}/schema/eduperson.ldif
include: file://{{ openldap.config_dir }}/schema/gakunin.ldif
include: file://{{ openldap.config_dir }}/schema/postfix.ldif

dn: olcDatabase=frontend,cn=config
objectClass: olcDatabaseConfig
olcDatabase: frontend
olcAccess: to * by dn.exact="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" by * none
olcAccess: to dn.exact="" by * read
olcAccess: to dn.base="cn=Subschema" by * read

dn: olcDatabase=config,cn=config
objectClass: olcDatabaseConfig
olcDatabase: config
olcAccess: to * by dn.exact="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" manage by * none

dn: olcDatabase=mdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcMdbConfig
olcDatabase: mdb
olcSuffix: {{ openldap.base }}
olcRootDN: {{ openldap.root.dn }}
olcRootPW:: {{ openldap.root.password }}
olcDbDirectory: /var/lib/ldap
olcDbIndex: objectClass eq,pres
olcDbIndex: ou eq,pres
olcDbIndex: cn,uid eq
olcDbIndex: mail eq
olcDbIndex: uidNumber,gidNumber eq
olcDbIndex: member,memberUid eq
olcAccess: to *
  by self write
  by users read
  by anonymous auth

dn: olcOverlay=memberof,olcDatabase=mdb,cn=config
objectClass: olcOverlayConfig
objectClass: olcMemberOf
olcOverlay: memberof
# olcMemberOfGroupOC: groupOfNames
# olcMemberOfMemberAD: member
# olcMemberOfMemberOfAD: memberOf
# olcMemberOfDangling: ignore
olcMemberOfRefInt: TRUE
